<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è›‡ç±»çŸ¥è¯†åˆ·é¢˜</title>
  <style>
    body { font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif; background: linear-gradient(135deg,#e3f0ff 0%,#f9f9f9 100%); margin: 0; padding: 0; }
    .container { max-width: 480px; margin: 56px auto 36px auto; background: #fff; border-radius: 28px; box-shadow: 0 8px 40px #1976d220; padding: 48px 28px 38px 28px; position: relative; }
    h1 { text-align: center; color: #1976d2; font-size: 2.3rem; letter-spacing: 2px; margin-bottom: 28px; font-weight: 700; }
    .top-btns { display: flex; justify-content: center; gap: 24px; margin-bottom: 18px; }
    .top-btn { min-width: 110px; font-size: 1.08rem; padding: 12px 0; border: none; border-radius: 18px; font-weight: 500; letter-spacing: 1px; box-shadow: 0 2px 8px #1976d220; cursor: pointer; transition: background 0.18s, box-shadow 0.18s, color 0.18s, transform 0.18s; }
    .top-btn.rank { background: linear-gradient(90deg,#43a047 60%,#a6e3a1 100%); color: #fff; }
    .top-btn.rank:hover { background: #388e3c; color: #fff; transform: translateY(-2px) scale(1.04); }
    .top-btn.wrong { background: linear-gradient(90deg,#ff7043 60%,#ffd6c8 100%); color: #fff; }
    .top-btn.wrong:hover { background: #e65100; color: #fff; transform: translateY(-2px) scale(1.04); }
    .img-box { display: flex; justify-content: center; align-items: center; margin: 36px 0 28px 0; }
    .img-box img { max-width: 360px; max-height: 240px; border-radius: 22px; border: 2.5px solid #e3eafc; background: #f6fafd; box-shadow: 0 4px 24px #1976d220; }
    .options { display: flex; flex-wrap: wrap; gap: 22px; justify-content: center; margin-bottom: 8px; }
    .option-btn { flex: 1 1 46%; min-width: 160px; min-height: 54px; background: linear-gradient(90deg,#e3eafc 60%,#f6fafd 100%); border: none; border-radius: 18px; padding: 0; font-size: 1.18rem; cursor: pointer; transition: background 0.18s, box-shadow 0.18s, color 0.18s, transform 0.18s; box-shadow: 0 2px 8px #1976d220; font-weight: 500; letter-spacing: 1px; display: flex; align-items: center; justify-content: center; }
    .option-btn:hover:not(:disabled) { background: #b6d0ff; color: #174ea6; box-shadow: 0 6px 18px #1976d233; transform: translateY(-2px) scale(1.04); }
    .option-btn.correct { background: linear-gradient(90deg,#a6e3a1 60%,#eafbe7 100%); color: #1b5e20; box-shadow: 0 2px 12px #43a04733; }
    .option-btn.wrong { background: linear-gradient(90deg,#ffb4ab 60%,#fff0ef 100%); color: #b71c1c; box-shadow: 0 2px 12px #b71c1c33; }
    .result { text-align: center; font-size: 1.22rem; margin: 22px 0 0 0; min-height: 36px; font-weight: bold; letter-spacing: 1px; }
    .next-btn { display: block; margin: 38px auto 0 auto; background: linear-gradient(90deg,#1976d2 60%,#63a4ff 100%); color: #fff; border: none; border-radius: 18px; padding: 15px 48px; font-size: 1.13rem; cursor: pointer; transition: background 0.18s, box-shadow 0.18s, transform 0.18s; box-shadow: 0 2px 8px #1976d233; font-weight: 500; letter-spacing: 1px; }
    .next-btn:hover { background: #1565c0; box-shadow: 0 6px 18px #1976d233; transform: translateY(-2px) scale(1.04); }
    .stats { text-align: center; color: #888; margin-top: 22px; font-size: 1.08rem; letter-spacing: 1px; }
    .answer-img-box { margin-top: 22px; text-align: center; }
    .answer-img-box img { max-width: 240px; max-height: 150px; border-radius: 14px; border: 2px solid #e3eafc; background: #f6fafd; margin-top: 4px; box-shadow: 0 2px 8px #0001; }
    /* å¼¹çª—åŠ¨ç”»ä¸æ ·å¼ */
    #rankModal, #wrongModal { display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:#0005; z-index:1000; align-items:center; justify-content:center; animation: fadeIn 0.25s; }
    #rankModal[style*="display: flex"], #wrongModal[style*="display: flex"] { animation: fadeIn 0.25s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    #rankModal > div, #wrongModal > div { background:#fff; padding:38px 32px 28px 32px; border-radius:22px; min-width:260px; max-width:96vw; box-shadow:0 8px 40px #1976d233; position:relative; }
    #rankModal h2, #wrongModal h2 { margin-top:0; text-align:center; color:#1976d2; letter-spacing:1px; font-size:1.35rem; }
    #rankContent { font-size:1.13rem; text-align:center; color:#333; }
    #wrongContent { font-size:1.08rem; }
    #wrongContent .wrong-item { display:flex; align-items:center; gap:18px; margin-bottom:22px; background:linear-gradient(90deg,#f6fafd 60%,#e3eafc 100%); border-radius:14px; padding:12px 10px; box-shadow:0 1px 4px #0001; }
    #wrongContent .wrong-item img { max-width:120px; max-height:80px; border-radius:10px; border:2px solid #e3eafc; background:#f6fafd; }
    #wrongContent .wrong-label { font-size:1.13rem; font-weight:500; color:#1976d2; letter-spacing:1px; }
    #wrongContent .wrong-index { color:#888; font-size:1.05rem; margin-right:8px; }
    #wrongContent .empty { color:#bbb; text-align:center; margin:38px 0 22px 0; font-size:1.13rem; }
    @media (max-width: 700px) {
      .container { max-width: 99vw; padding: 8vw 2vw 8vw 2vw; margin: 0; border-radius: 0; box-shadow: none; }
      .img-box img { max-width: 92vw; max-height: 38vw; border-radius: 8vw; }
      .option-btn { min-width: 44vw; font-size: 1.02rem; min-height: 40px; border-radius: 8vw; }
      .next-btn { font-size: 1.02rem; padding: 11px 18vw; border-radius: 8vw; }
      .answer-img-box img { max-width: 70vw; max-height: 28vw; border-radius: 6vw; }
      #rankModal > div, #wrongModal > div { min-width: 0; padding: 6vw 2vw 4vw 2vw; border-radius: 6vw; }
    }
    #wrongModal > div { display: flex; flex-direction: column; align-items: center; }
    #wrongModal h2 { font-size: 1.6rem; font-weight: 700; color: #1976d2; margin-bottom: 18px; letter-spacing: 2px; }
    #wrongContent { width: 100%; margin-bottom: 28px; }
    #wrongContent .empty { color: #bbb; text-align: center; margin: 44px 0 32px 0; font-size: 1.18rem; display: flex; flex-direction: column; align-items: center; }
    #wrongContent .empty::before { content: 'ğŸ˜ƒ'; font-size: 2.2rem; margin-bottom: 8px; }
    .wrong-btns { width: 100%; display: flex; flex-direction: column; gap: 18px; align-items: center; }
    .wrong-action-btn { width: 90%; max-width: 320px; min-width: 180px; padding: 15px 0; border: none; border-radius: 22px; font-size: 1.13rem; font-weight: 600; letter-spacing: 1px; margin: 0 auto; box-shadow: 0 2px 8px #1976d220; cursor: pointer; transition: background 0.18s, box-shadow 0.18s, transform 0.18s; }
    .wrong-action-btn.review { background: linear-gradient(90deg,#1976d2 60%,#63a4ff 100%); color: #fff; }
    .wrong-action-btn.review:hover { background: #1565c0; box-shadow: 0 6px 18px #1976d233; transform: translateY(-2px) scale(1.04); }
    .wrong-action-btn.clear { background: linear-gradient(90deg,#d32f2f 60%,#ffb4ab 100%); color: #fff; }
    .wrong-action-btn.clear:hover { background: #b71c1c; box-shadow: 0 6px 18px #b71c1c33; transform: translateY(-2px) scale(1.04); }
    .wrong-action-btn.close { background: #bdbdbd; color: #fff; }
    .wrong-action-btn.close:hover { background: #888; box-shadow: 0 6px 18px #8883; transform: translateY(-2px) scale(1.04); }
    @media (max-width: 700px) {
      #wrongModal > div { padding: 8vw 2vw 6vw 2vw; border-radius: 6vw; }
      .wrong-action-btn { min-width: 0; width: 98%; font-size: 1.01rem; border-radius: 8vw; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>è›‡ç±»çŸ¥è¯†åˆ·é¢˜</h1>
    <div class="top-btns">
      <button class="top-btn rank" id="rankBtn">æ’è¡Œæ¦œ</button>
      <button class="top-btn wrong" id="wrongBtn">é”™é¢˜æœ¬</button>
    </div>
    <div class="img-box" id="imgBox">
      <img id="questionImg" src="" alt="è›‡ç±»å›¾ç‰‡" style="display:none;"/>
    </div>
    <div class="options" id="optionsBox"></div>
    <div class="result" id="resultBox"></div>
    <div class="answer-img-box" id="answerImgBox" style="text-align:center;margin-top:10px;"></div>
    <button class="next-btn" id="nextBtn" style="display:none;">ä¸‹ä¸€é¢˜</button>
    <div class="stats" id="statsBox"></div>
  </div>
  <!-- æ’è¡Œæ¦œå¼¹çª— -->
  <div id="rankModal" style="display:none;position:fixed;left:0;top:0;width:100vw;height:100vh;background:#0005;z-index:1000;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:28px 32px;border-radius:10px;min-width:260px;max-width:90vw;box-shadow:0 2px 12px #0002;position:relative;">
      <h2 style="margin-top:0;text-align:center;">æ’è¡Œæ¦œ</h2>
      <div id="rankContent" style="font-size:16px;text-align:center;"></div>
      <button class="next-btn" id="closeRankBtn" style="margin-top:18px;background:#888;">å…³é—­</button>
    </div>
  </div>
  <!-- é”™é¢˜æœ¬å¼¹çª— -->
  <div id="wrongModal" style="display:none;position:fixed;left:0;top:0;width:100vw;height:100vh;background:#0005;z-index:1000;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:24px 18px 18px 18px;border-radius:10px;min-width:280px;max-width:96vw;max-height:90vh;overflow:auto;box-shadow:0 2px 12px #0002;position:relative;">
      <h2>é”™é¢˜æœ¬</h2>
      <div id="wrongContent"></div>
      <div class="wrong-btns">
        <button class="wrong-action-btn review" id="reviewWrongBtn">é”™é¢˜å¤ä¹ </button>
        <button class="wrong-action-btn clear" id="clearWrongBtn">æ¸…ç©ºé”™é¢˜æœ¬</button>
        <button class="wrong-action-btn close" id="closeWrongBtn">å…³é—­</button>
      </div>
    </div>
  </div>
  <script>
    // 1. é¢˜åº“æ•°æ®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
    // const questionBase = [
    //   // è¿™é‡Œå°†ç”±è„šæœ¬è‡ªåŠ¨å¡«å……æ‰€æœ‰é¢˜ç›®
    // ];
    // const categories = [
    //   // è¿™é‡Œå°†ç”±è„šæœ¬è‡ªåŠ¨å¡«å……æ‰€æœ‰ç±»åˆ«
    // ];

    // 2. è‡ªåŠ¨æ‰«æ pic/questions ç›®å½•ï¼Œç”Ÿæˆé¢˜åº“å’Œç±»åˆ«
    // ç”±äºå‰ç«¯æ— æ³•ç›´æ¥è¯»å–æœ¬åœ°ç›®å½•ï¼Œéœ€æ‰‹åŠ¨/è„šæœ¬ç”Ÿæˆæ•°æ®ï¼Œæˆ–ç”¨æ„å»ºå·¥å…·è‡ªåŠ¨ç”Ÿæˆ
    // è¿™é‡Œç”¨é™æ€æ•°æ®å¡«å……ï¼ˆè¯·ç”¨è„šæœ¬ç”Ÿæˆåæ›¿æ¢ï¼‰
    // ç¤ºä¾‹ï¼š
    // questionBase = [ { category: 'ç‹é”¦è›‡èœèŠ±è›‡', img: 'pic/questions/ç‹é”¦è›‡èœèŠ±è›‡/1.png' }, ... ]
    // categories = [ 'ç‹é”¦è›‡èœèŠ±è›‡', ... ]

    // ==== è‡ªåŠ¨ç”Ÿæˆæ•°æ®å¼€å§‹ ====
    // ä¸‹é¢å†…å®¹è¯·ç”¨è„šæœ¬è‡ªåŠ¨ç”Ÿæˆ
    const autoData = (() => {
      const cats = [
        "åŠç¯æ‰å°¾æµ·è›‡","æ–‘ç«¹èŠ±è›‡é³—","æ£•é»‘é”¦è›‡","æ°´æ¸¸è›‡","ç‰æ–‘ä¸½è›‡","ç‹é”¦è›‡èœèŠ±è›‡","ç™½æ•ç™½ç¯è›‡","ç™¾èŠ±é”¦è›‡","çœ¼é•œç‹è›‡","çŸ­å°¾è…¹","çº¢è…¹ä¼Šæ¾³è›‡","ç´«æ£•å°å¤´è›‡","ç´«æ²™è›‡","ç»¿ç˜¦è›‡","ç½‘çº¹èŸ’","èˆŸå±±çœ¼é•œè›‡","è’åŸéæ´²è—¤è›‡","è½å±±åŸçŸ›å¤´è®","è™æ–‘é¢ˆæ§½è›‡","é“¶ç¯è›‡","é©¬æ¥ç¯è›‡","é©¬æ¥è…¹","é»„æ–‘æ¸”æ¸¸è›‡","é»‘çœ‰é”¦è›‡"
      ];
      const imgs = [
        [1],[1],[1],[1],[1],[1,2],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1,2],[1],[1],[1,2],[1],[1],[1],[1],[1,2,3]
      ];
      let qb = [];
      cats.forEach((cat, i) => {
        imgs[i].forEach(num => {
          qb.push({ category: cat, img: `pic/questions/${cat}/${num}.png` });
        });
      });
      return { cats, qb };
    })();
    const categories = autoData.cats;
    const questionBase = autoData.qb;
    // ==== è‡ªåŠ¨ç”Ÿæˆæ•°æ®ç»“æŸ ====

    // æ’è¡Œæ¦œå’Œé”™é¢˜æœ¬æ•°æ®ç»“æ„
    function getRank() {
      return JSON.parse(localStorage.getItem('snake_rank')||'{"maxRate":0,"maxCorrect":0,"maxTotal":0}')
    }
    function setRank(rank) {
      localStorage.setItem('snake_rank', JSON.stringify(rank));
    }
    function updateRank() {
      let rank = getRank();
      let rate = stats.total ? stats.correct / stats.total : 0;
      if (rate > rank.maxRate) rank.maxRate = rate;
      if (stats.correct > rank.maxCorrect) rank.maxCorrect = stats.correct;
      if (stats.total > rank.maxTotal) rank.maxTotal = stats.total;
      setRank(rank);
    }
    function showRankModal() {
      let rank = getRank();
      document.getElementById('rankContent').innerHTML =
        `æœ€é«˜æ­£ç¡®ç‡ï¼š<b>${Math.round(rank.maxRate*100)}%</b><br>æœ€é«˜æ­£ç¡®æ•°ï¼š<b>${rank.maxCorrect}</b><br>æœ€é«˜ç­”é¢˜æ•°ï¼š<b>${rank.maxTotal}</b>`;
      document.getElementById('rankModal').style.display = 'flex';
    }
    // é”™é¢˜æœ¬
    function getWrongBook() {
      return JSON.parse(localStorage.getItem('snake_wrong')||'[]');
    }
    function setWrongBook(arr) {
      localStorage.setItem('snake_wrong', JSON.stringify(arr));
    }
    function addWrong(q) {
      let arr = getWrongBook();
      // é¿å…é‡å¤
      if (!arr.some(item=>item.img===q.img)) {
        arr.push(q);
        setWrongBook(arr);
      }
    }
    function clearWrongBook() {
      setWrongBook([]);
    }
    function showWrongModal() {
      let arr = getWrongBook();
      let html = arr.length ? arr.map((q,i)=>
        `<div class='wrong-item'><span class='wrong-index'>${i+1}.</span><img src='${q.img}' alt='é”™é¢˜å›¾ç‰‡'><span class='wrong-label'>${q.category}</span></div>`
      ).join('') : '<div class="empty">æš‚æ— é”™é¢˜ï¼Œç»§ç»­åŠ æ²¹ï¼</div>';
      document.getElementById('wrongContent').innerHTML = html;
      document.getElementById('wrongModal').style.display = 'flex';
    }
    // é”™é¢˜å¤ä¹ æ¨¡å¼
    let wrongReviewList = [];
    let wrongReviewIdx = 0;
    function startWrongReview() {
      wrongReviewList = getWrongBook();
      wrongReviewIdx = 0;
      if (!wrongReviewList.length) {
        alert('æš‚æ— é”™é¢˜');
        return;
      }
      document.getElementById('wrongModal').style.display = 'none';
      showWrongQuestion();
    }
    function showWrongQuestion() {
      if (wrongReviewIdx >= wrongReviewList.length) {
        alert('é”™é¢˜å¤ä¹ å·²å®Œæˆï¼');
        showQuestion();
        return;
      }
      answered = false;
      current = wrongReviewList[wrongReviewIdx];
      document.getElementById('questionImg').src = current.img;
      document.getElementById('questionImg').style.display = '';
      document.getElementById('resultBox').textContent = '';
      document.getElementById('nextBtn').style.display = 'none';
      document.getElementById('answerImgBox').innerHTML = '';
      // ç”Ÿæˆ6ä¸ªé€‰é¡¹ï¼ˆ1ä¸ªæ­£ç¡®+5ä¸ªé”™è¯¯ï¼‰
      let wrongCats = categories.filter(cat => cat !== current.category);
      let selectedWrongs = shuffle(wrongCats).slice(0, 5);
      let options = shuffle([current.category, ...selectedWrongs]);
      const optionsBox = document.getElementById('optionsBox');
      optionsBox.innerHTML = '';
      options.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = cat;
        btn.onclick = () => selectWrongOption(cat, btn);
        optionsBox.appendChild(btn);
      });
    }
    function selectWrongOption(cat, btn) {
      if (answered) return;
      answered = true;
      const optionsBtns = document.querySelectorAll('.option-btn');
      optionsBtns.forEach(b => {
        b.disabled = true;
        if (b.textContent === current.category) b.classList.add('correct');
        if (b === btn && cat !== current.category) b.classList.add('wrong');
      });
      if (cat === current.category) {
        document.getElementById('resultBox').textContent = 'ç­”å¯¹äº†ï¼';
      } else {
        document.getElementById('resultBox').textContent = `ç­”é”™äº†ï¼Œæ­£ç¡®ç­”æ¡ˆï¼š${current.category}`;
      }
      // ç­”æ¡ˆå›¾ç‰‡
      showAnswerImg();
      document.getElementById('nextBtn').style.display = '';
      document.getElementById('nextBtn').onclick = () => {
        wrongReviewIdx++;
        showWrongQuestion();
      };
    }
    // ç­”æ¡ˆå›¾ç‰‡æ˜¾ç¤º
    function showAnswerImg() {
      // é¢˜ç›®å›¾ç‰‡åå¦‚ pic/questions/ç±»åˆ«/1.png => ç­”æ¡ˆå›¾ç‰‡ pic/results/ç±»åˆ«/1.png
      let qimg = current.img;
      let ansImg = qimg.replace('questions','results');
      let img = document.createElement('img');
      img.src = ansImg;
      img.style.maxWidth = '180px';
      img.style.maxHeight = '120px';
      img.style.borderRadius = '6px';
      img.style.border = '1px solid #eee';
      img.onerror = function(){this.style.display='none';};
      let box = document.getElementById('answerImgBox');
      box.innerHTML = '<div style="color:#888;font-size:14px;">ç­”æ¡ˆå›¾ç‰‡ï¼š</div>';
      box.appendChild(img);
    }

    // 3. é¢˜ç›®çŠ¶æ€
    let current = null;
    let answered = false;
    let stats = { total: 0, correct: 0 };

    function pickQuestion() {
      const idx = Math.floor(Math.random() * questionBase.length);
      return questionBase[idx];
    }

    function showQuestion() {
      answered = false;
      current = pickQuestion();
      document.getElementById('questionImg').src = current.img;
      document.getElementById('questionImg').style.display = '';
      document.getElementById('resultBox').textContent = '';
      document.getElementById('nextBtn').style.display = 'none';
      document.getElementById('answerImgBox').innerHTML = '';
      // ç”Ÿæˆ6ä¸ªé€‰é¡¹ï¼ˆ1ä¸ªæ­£ç¡®+5ä¸ªé”™è¯¯ï¼‰
      let wrongCats = categories.filter(cat => cat !== current.category);
      let selectedWrongs = shuffle(wrongCats).slice(0, 5);
      let options = shuffle([current.category, ...selectedWrongs]);
      const optionsBox = document.getElementById('optionsBox');
      optionsBox.innerHTML = '';
      options.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = cat;
        btn.onclick = () => selectOption(cat, btn);
        optionsBox.appendChild(btn);
      });
    }

    function selectOption(cat, btn) {
      if (answered) return;
      answered = true;
      stats.total++;
      const optionsBtns = document.querySelectorAll('.option-btn');
      optionsBtns.forEach(b => {
        b.disabled = true;
        if (b.textContent === current.category) b.classList.add('correct');
        if (b === btn && cat !== current.category) b.classList.add('wrong');
      });
      if (cat === current.category) {
        document.getElementById('resultBox').textContent = 'ç­”å¯¹äº†ï¼';
        stats.correct++;
      } else {
        document.getElementById('resultBox').textContent = `ç­”é”™äº†ï¼Œæ­£ç¡®ç­”æ¡ˆï¼š${current.category}`;
        addWrong(current);
        showAnswerImg();
      }
      document.getElementById('nextBtn').style.display = '';
      updateStats();
      updateRank();
    }

    function updateStats() {
      document.getElementById('statsBox').textContent = `å·²ç­”ï¼š${stats.total}ï¼Œæ­£ç¡®ï¼š${stats.correct}ï¼Œæ­£ç¡®ç‡ï¼š${stats.total ? Math.round(stats.correct / stats.total * 100) : 0}%`;
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    document.getElementById('nextBtn').onclick = showQuestion;
    document.getElementById('rankBtn').onclick = showRankModal;
    document.getElementById('closeRankBtn').onclick = function(){document.getElementById('rankModal').style.display='none';};
    document.getElementById('wrongBtn').onclick = showWrongModal;
    document.getElementById('closeWrongBtn').onclick = function(){document.getElementById('wrongModal').style.display='none';};
    document.getElementById('clearWrongBtn').onclick = function(){if(confirm('ç¡®å®šæ¸…ç©ºé”™é¢˜æœ¬ï¼Ÿ')){clearWrongBook();showWrongModal();}};
    document.getElementById('reviewWrongBtn').onclick = startWrongReview;
    window.onload = () => {
      showQuestion();
      updateStats();
    };
  </script>
</body>
</html> 